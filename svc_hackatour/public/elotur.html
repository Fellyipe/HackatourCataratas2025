<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>EloTur - Conectando o Turismo Local</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .page-content {
        display: none;
      }
      .active-page {
        display: block;
      }
      .nav-link {
        cursor: pointer;
      }
    </style>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              "elotur-blue": "#3B82F6",
              "elotur-green": "#10B981",
              "elotur-light": "#F3F4F6",
            },
          },
        },
      };
    </script>
    <!-- jsPDF CDN para gera√ß√£o de PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-10">
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex justify-between items-center"
      >
        <h1
          class="text-3xl font-extrabold text-elotur-blue cursor-pointer"
          onclick="showPage('home')"
        >
          <span class="text-elotur-green">Elo</span>Tur
        </h1>
        <!-- Menu de Navega√ß√£o -->
        <nav class="space-x-4">
          <a
            class="nav-link text-gray-600 hover:text-elotur-blue font-medium"
            onclick="showPage('home')"
            >Home</a
          >
          <a
            class="nav-link text-gray-600 hover:text-elotur-blue font-medium"
            onclick="showPage('hotel')"
            >Sou Hotel</a
          >
          <a
            class="nav-link text-gray-600 hover:text-elotur-blue font-medium"
            onclick="showPage('provider')"
            >Sou Prestador</a
          >
          <a
            class="nav-link text-gray-600 hover:text-elotur-blue font-medium"
            onclick="showPage('guest')"
            >Sou H√≥spede</a
          >
          <a
            class="nav-link text-gray-600 hover:text-elotur-blue font-medium hidden sm:inline"
            onclick="showPage('about')"
            >Sobre</a
          >
          <a
            class="nav-link text-gray-600 hover:text-elotur-blue font-medium hidden sm:inline"
            onclick="showPage('feedback')"
            >Feedback</a
          >
        </nav>
      </div>
    </header>

    <main class="max-w-7xl mx-auto p-4 sm:p-6 lg:p-8">
      <!-- Home -->
      <section
        id="home"
        class="page-content active-page py-16 text-center bg-white rounded-xl shadow-lg"
      >
        <div class="max-w-3xl mx-auto">
          <p class="text-elotur-green font-semibold text-lg mb-2">
            ü§ù Parcerias que fortalecem o destino
          </p>
          <h2
            class="text-4xl sm:text-5xl font-extrabold text-gray-800 mb-6 leading-tight"
          >
            <span class="text-elotur-blue">Conectando</span> o turismo local.
          </h2>
          <p class="text-lg text-gray-600 mb-10">
            A EloTur √© a sua plataforma de networking e coopera√ß√£o no trade
            tur√≠stico.
          </p>
          <div class="space-y-4 sm:space-y-0 sm:space-x-6">
            <button
              onclick="showPage('hotel')"
              class="w-full sm:w-auto bg-elotur-blue hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg transition duration-300 shadow-lg shadow-elotur-blue/30 transform hover:scale-[1.02]"
            >
              Sou Hotel & Buscar Prestadores
            </button>
            <button
              onclick="showPage('provider')"
              class="w-full sm:w-auto bg-elotur-green hover:bg-emerald-600 text-white font-bold py-3 px-8 rounded-lg transition duration-300 shadow-lg shadow-elotur-green/30 transform hover:scale-[1.02]"
            >
              Sou Prestador de Servi√ßo & Cadastrar
            </button>
          </div>
        </div>
      </section>

      <!-- Hotel: Diret√≥rio + Gerar Vouchers -->
      <section id="hotel" class="page-content">
        <h2 class="text-3xl font-bold text-gray-800 mb-6">
          Diret√≥rio de Prestadores
        </h2>
        <p class="text-gray-600 mb-8">
          Encontre e contate parceiros locais de confian√ßa para enriquecer a
          experi√™ncia dos seus h√≥spedes.
        </p>

        <!-- Vouchers: Gerar -->
        <div class="bg-white p-6 rounded-xl shadow-md mb-8">
          <h3 class="text-xl font-semibold mb-3">Gerar Voucher / Link</h3>
          <form
            id="voucher-form"
            onsubmit="handleVoucherCreate(event)"
            class="grid grid-cols-1 md:grid-cols-3 gap-3"
          >
            <input
              id="hotel-name"
              placeholder="Nome do Hotel"
              class="p-3 border rounded"
              value="Hotel Demo"
            />
            <input
              id="provider-name"
              placeholder="Nome do Prestador"
              class="p-3 border rounded"
              value="Passeios Aventura Max"
            />
            <input
              id="guest-email"
              placeholder="E-mail do h√≥spede (opcional)"
              class="p-3 border rounded"
            />
            <div class="md:col-span-3 flex gap-2">
              <button
                type="submit"
                class="bg-elotur-green text-white px-4 py-2 rounded"
              >
                Gerar Voucher
              </button>
              <button
                type="button"
                onclick="fetchVouchers()"
                class="bg-white border px-4 py-2 rounded"
              >
                Atualizar Lista
              </button>
              <div
                id="voucher-create-msg"
                class="text-sm text-green-600 self-center ml-2"
              ></div>
            </div>
          </form>
        </div>

        <!-- Filtros e Busca (mantive o mockup original) -->
        <div
          class="bg-white p-4 rounded-xl shadow-md mb-8 flex flex-col md:flex-row gap-4 items-center"
        >
          <input
            type="text"
            id="search-input"
            oninput="renderProviderListings()"
            placeholder="Buscar por nome ou descri√ß√£o..."
            class="flex-grow p-3 border border-gray-300 rounded-lg focus:ring-elotur-blue focus:border-elotur-blue"
          />
          <select
            id="category-filter"
            onchange="renderProviderListings()"
            class="p-3 border border-gray-300 rounded-lg w-full md:w-auto focus:ring-elotur-blue focus:border-elotur-blue bg-white"
          >
            <option value="Todos">Todas as Categorias</option>
            <option value="Passeios">Passeios e Aventura</option>
            <option value="Transporte">Transporte e Transfer</option>
            <option value="Gastronomia">Gastronomia</option>
            <option value="Eventos">Eventos e Shows</option>
            <option value="Guias">Guias de Turismo</option>
          </select>
        </div>

        <!-- Lista de Cards (Providers) -->
        <div
          id="provider-listings"
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 mb-8"
        >
          <!-- Cards injetados por JS -->
        </div>

        <!-- Vouchers gerados (exibi√ß√£o resumida) -->
        <div class="bg-white p-4 rounded-xl shadow-md">
          <h3 class="text-lg font-semibold mb-2">Vouchers recentes</h3>
          <div
            id="hotel-voucher-list"
            class="grid grid-cols-1 sm:grid-cols-2 gap-2"
          ></div>
        </div>
      </section>

      <!-- Prestador: validar voucher -->
      <section id="provider" class="page-content">
        <div class="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow-lg">
          <h2 class="text-3xl font-bold text-gray-800 mb-4">
            Painel do Prestador ‚Äî Validar Voucher
          </h2>
          <p class="text-gray-600 mb-8">
            Valide vouchers enviados pelos hot√©is ou via QR (simula√ß√£o).
          </p>

          <div class="mb-5">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >C√≥digo do Voucher</label
            >
            <div class="flex gap-2">
              <input
                id="validate-input"
                class="flex-1 p-3 border rounded-lg"
                placeholder="EXEMP-1234"
              />
              <button
                onclick="handleValidateClick()"
                class="bg-elotur-blue text-white px-4 py-2 rounded"
              >
                Validar
              </button>
            </div>
            <div id="validate-msg" class="mt-2 text-sm"></div>
          </div>

          <div class="mb-6">
            <h3 class="font-semibold">Ou usar c√¢mera (simulado)</h3>
            <div id="camera-area">
              <button
                id="open-camera"
                onclick="startCamera()"
                class="bg-gray-700 text-white px-3 py-1 rounded"
              >
                Abrir c√¢mera
              </button>
              <div id="scan-wrapper" class="mt-2 hidden">
                <video
                  id="scanVideo"
                  class="w-full max-w-sm my-2 border"
                  autoplay
                  muted
                ></video>
                <div class="flex gap-2">
                  <button
                    onclick="simulateScan()"
                    class="bg-green-500 text-white px-3 py-1 rounded"
                  >
                    Simular leitura
                  </button>
                  <button
                    onclick="stopCamera()"
                    class="bg-red-500 text-white px-3 py-1 rounded"
                  >
                    Fechar c√¢mera
                  </button>
                </div>
              </div>
            </div>
          </div>

          <h3 class="font-semibold">√öltimos vouchers</h3>
          <div
            id="provider-voucher-list"
            class="mt-2 grid grid-cols-1 sm:grid-cols-2 gap-2"
          ></div>
        </div>
      </section>

      <!-- H√≥spede: vis√£o dos vouchers (link que hotel envia) -->
      <section id="guest" class="page-content">
        <div class="max-w-3xl mx-auto bg-white p-8 rounded-xl shadow-lg">
          <h2 class="text-3xl font-bold text-gray-800 mb-4">
            Vis√£o do H√≥spede ‚Äî Meus Vouchers
          </h2>
          <p class="text-gray-600 mb-6">
            Insira seu e-mail para ver vouchers vinculados a voc√™ e baixar o
            PDF.
          </p>

          <div class="mb-4">
            <label class="block text-sm font-medium text-gray-700 mb-1"
              >Filtrar por e-mail</label
            >
            <div class="flex gap-2">
              <input
                id="guest-email-filter"
                class="flex-1 p-3 border rounded"
                placeholder="hospede@exemplo.com"
              />
              <button
                onclick="renderGuestList()"
                class="bg-elotur-blue text-white px-3 py-1 rounded"
              >
                Mostrar
              </button>
            </div>
          </div>

          <div
            id="guest-voucher-list"
            class="grid grid-cols-1 sm:grid-cols-2 gap-3"
          ></div>
        </div>
      </section>

      <!-- About -->
      <section id="about" class="page-content">
        <div class="bg-white p-8 rounded-xl shadow-lg">
          <h2 class="text-3xl font-bold text-elotur-blue mb-4">
            Nossa Miss√£o: Fortalecer o Destino
          </h2>
          <p class="text-lg text-gray-600 mb-8">
            A EloTur nasceu da necessidade de transformar o cen√°rio tur√≠stico
            local.
          </p>
        </div>
      </section>

      <!-- Feedback -->
      <section id="feedback" class="page-content">
        <div class="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow-lg">
          <h2 class="text-3xl font-bold text-gray-800 mb-4">
            Diga-nos o que voc√™ achou!
          </h2>
          <p class="text-gray-600 mb-8">
            Seu feedback √© essencial para aprimorarmos o conceito da EloTur.
          </p>

          <form id="feedback-form" onsubmit="handleFeedbackSubmit(event)">
            <div class="mb-6">
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >1. Voc√™ usaria essa plataforma no seu dia a dia?</label
              >
              <div class="flex flex-wrap gap-4">
                <label class="inline-flex items-center"
                  ><input
                    type="radio"
                    name="usage"
                    value="Sim, com certeza"
                    required
                    class="form-radio text-elotur-blue h-5 w-5 rounded-full"
                  /><span class="ml-2 text-gray-700"
                    >Sim, com certeza</span
                  ></label
                >
                <label class="inline-flex items-center"
                  ><input
                    type="radio"
                    name="usage"
                    value="Talvez, se tiver mais parceiros"
                    class="form-radio text-elotur-blue h-5 w-5 rounded-full"
                  /><span class="ml-2 text-gray-700">Talvez</span></label
                >
                <label class="inline-flex items-center"
                  ><input
                    type="radio"
                    name="usage"
                    value="N√£o, prefiro m√©todos tradicionais"
                    class="form-radio text-elotur-blue h-5 w-5 rounded-full"
                  /><span class="ml-2 text-gray-700">N√£o</span></label
                >
              </div>
            </div>

            <div class="mb-6">
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >2. O que mais gostou na proposta?</label
              >
              <textarea
                id="most-liked"
                required
                rows="3"
                class="w-full p-3 border border-gray-300 rounded-lg"
              ></textarea>
            </div>

            <div class="mb-8">
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >3. O que voc√™ mudaria?</label
              >
              <textarea
                id="to-change"
                required
                rows="3"
                class="w-full p-3 border border-gray-300 rounded-lg"
              ></textarea>
            </div>

            <button
              type="submit"
              class="w-full bg-elotur-blue hover:bg-blue-600 text-white font-bold py-3 rounded-lg"
            >
              Enviar Feedback
            </button>
            <p
              id="feedback-message"
              class="mt-4 text-center text-sm font-medium hidden"
            ></p>
          </form>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-12">
      <div
        class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 flex flex-col sm:flex-row justify-between items-center text-center sm:text-left"
      >
        <div class="mb-4 sm:mb-0">
          <h4 class="text-xl font-bold">EloTur</h4>
          <p class="text-gray-400 text-sm">
            ¬© 2025 EloTur. Todos os direitos reservados.
          </p>
        </div>
        <div
          class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-6 text-sm"
        >
          <a
            href="#"
            class="text-gray-300 hover:text-elotur-green transition duration-300"
            >Contato: contato@elotur.com</a
          >
          <a
            href="#"
            class="text-gray-300 hover:text-elotur-green transition duration-300"
            onclick="showPage('about')"
            >Pol√≠tica de Privacidade</a
          >
        </div>
      </div>
    </footer>

    <script>
      /* ---------- dados mock de providers (mantive como antes) ---------- */
      const mockProviders = [
        {
          id: 1,
          name: "Passeios Aventura Max",
          category: "Passeios",
          description:
            "Trilhas guiadas, rapel e tirolesa na natureza exuberante.",
          contact: "(45) 99123-4567 (WhatsApp)",
          logoText: "AV",
          logoColor: "bg-elotur-green",
        },
        {
          id: 2,
          name: "Transporte VIP Prime",
          category: "Transporte",
          description:
            "Frota executiva com carros de luxo e motoristas bil√≠ngues.",
          contact: "contato@vip-prime.com",
          logoText: "TX",
          logoColor: "bg-elotur-blue",
        },
        {
          id: 3,
          name: "Sabor Regional Gourmet",
          category: "Gastronomia",
          description: "Restaurante com foco em culin√°ria regional inovadora.",
          contact: "(45) 3578-1234",
          logoText: "RS",
          logoColor: "bg-amber-500",
        },
        {
          id: 4,
          name: "Guias Certificados Local",
          category: "Guias",
          description:
            "Guias credenciados para Foz e Regi√£o. Pacotes personalizados.",
          contact: "guias@local.com",
          logoText: "GS",
          logoColor: "bg-red-500",
        },
        {
          id: 5,
          name: "Mega Eventos Corporativos",
          category: "Eventos",
          description:
            "Organiza√ß√£o de congressos, feiras e shows com estrutura completa.",
          contact: "(45) 98765-4321",
          logoText: "EV",
          logoColor: "bg-indigo-500",
        },
        {
          id: 6,
          name: "Transfer R√°pido e Seguro",
          category: "Transporte",
          description: "Servi√ßo de transfer aeroporto/hotel 24h.",
          contact: "(45) 99999-0000",
          logoText: "TR",
          logoColor: "bg-elotur-blue",
        },
        {
          id: 7,
          name: "Cicloturismo Verde",
          category: "Passeios",
          description: "Aluguel de bicicletas e roteiros de cicloturismo.",
          contact: "(45) 98888-1111",
          logoText: "CT",
          logoColor: "bg-elotur-green",
        },
      ];

      /* ---------- navega√ß√£o entre se√ß√µes (mantive igual) ---------- */
      function showPage(pageId) {
        document
          .querySelectorAll(".page-content")
          .forEach((section) => section.classList.remove("active-page"));
        const target = document.getElementById(pageId);
        if (target) {
          target.classList.add("active-page");
          window.scrollTo({ top: 0, behavior: "smooth" });
          if (pageId === "hotel") {
            renderProviderListings();
            fetchVouchers();
          }
          if (pageId === "provider") {
            fetchVouchers();
          }
          if (pageId === "guest") {
            renderGuestList();
          }
        }
      }

      /* ---------- render providers (igual ao mockup) ---------- */
      function renderProviderListings() {
        const container = document.getElementById("provider-listings");
        const filter = document.getElementById("category-filter").value;
        const search = document
          .getElementById("search-input")
          .value.toLowerCase();
        const filtered = mockProviders.filter((p) => {
          const cat = filter === "Todos" || p.category === filter;
          const s =
            !search ||
            p.name.toLowerCase().includes(search) ||
            p.description.toLowerCase().includes(search);
          return cat && s;
        });
        container.innerHTML = "";
        if (!filtered.length) {
          container.innerHTML = `<div class="col-span-full text-center py-10 text-gray-500 bg-gray-100 rounded-lg">Nenhum prestador encontrado com os filtros aplicados.</div>`;
          return;
        }
        filtered.forEach((provider) => {
          const isPremium = provider.id < 3;
          const premiumBadge = isPremium
            ? `<span class="absolute top-2 right-2 bg-yellow-400 text-yellow-900 text-xs font-bold px-3 py-1 rounded-full shadow-md">PREMIUM</span>`
            : "";
          const contactBtnClass = isPremium
            ? "bg-elotur-blue hover:bg-blue-600"
            : "bg-elotur-green hover:bg-emerald-600";
          const premiumStyle = isPremium
            ? "border-elotur-blue ring-4 ring-elotur-blue/20 transform hover:scale-[1.03]"
            : "border-gray-200 hover:shadow-lg";
          const card = `
          <div class="bg-white p-6 rounded-xl shadow-md border ${premiumStyle} transition duration-300 relative">
            ${premiumBadge}
            <div class="flex items-start space-x-4 mb-4">
              <div class="w-16 h-16 rounded-full flex items-center justify-center text-white text-xl font-bold ${
                provider.logoColor
              } flex-shrink-0 shadow-lg">${provider.logoText}</div>
              <div>
                <h3 class="text-xl font-bold text-gray-800">${
                  provider.name
                }</h3>
                <p class="text-sm text-elotur-green font-medium">${
                  provider.category
                }</p>
              </div>
            </div>
            <p class="text-gray-600 mb-4 text-sm">${provider.description}</p>
            <p class="text-xs text-gray-500 mb-4">Localiza√ß√£o: <span class="font-semibold">Centro/Regi√£o Tur√≠stica</span></p>
            <button onclick="handleContact('${provider.name}', ${isPremium}, '${
            provider.contact
          }')" class="w-full text-white font-bold py-2 rounded-lg transition duration-300 ${contactBtnClass}">
              ${
                isPremium
                  ? `üìû Contato Direto: ${provider.contact}`
                  : "Entrar em Contato (via EloTur)"
              }
            </button>
          </div>
        `;
          container.innerHTML += card;
        });
      }

      function handleContact(name, isPremium, contact) {
        alert(
          `Simula√ß√£o: iniciar contato com ${name} (${
            isPremium ? "direto" : "via EloTur"
          }) ‚Äî ${contact}`
        );
      }

      /* ---------- VOUCHERS: integra√ß√£o com API (supabase-backed) ---------- */
      async function fetchVouchers() {
        try {
          const res = await fetch("/api/vouchers");
          if (!res.ok) throw new Error("Falha ao buscar vouchers");
          const json = await res.json();
          const list = json.vouchers || [];
          renderHotelList(list);
          renderProviderList(list);
          renderGuestListFrom(list); // atualiza guest internal cache
        } catch (err) {
          console.error(err);
        }
      }

      function renderHotelList(list) {
        const out = document.getElementById("hotel-voucher-list");
        out.innerHTML = "";
        if (!list.length)
          return (out.innerHTML =
            '<div class="text-gray-500">Nenhum voucher gerado ainda.</div>');
        list.slice(0, 6).forEach((v) => {
          const item = document.createElement("div");
          item.className =
            "p-3 border rounded flex justify-between items-center";
          item.innerHTML = `
          <div>
            <div class="font-bold">${v.code}</div>
            <div class="text-xs text-gray-500">${v.hotel} ‚Ä¢ ${v.provider}</div>
          </div>
          <div class="flex gap-2">
            <button class="text-sm bg-blue-500 text-white px-2 py-1 rounded" onclick="downloadVoucherPDF(${encodeURIComponent(
              JSON.stringify(v)
            )})">Baixar</button>
            <button class="text-sm bg-gray-200 px-2 py-1 rounded" onclick='window.open("${
              location.pathname
            }?code=${v.code}", "_blank")'>Abrir link</button>
          </div>
        `;
          out.appendChild(item);
        });
      }

      function renderProviderList(list) {
        const out = document.getElementById("provider-voucher-list");
        out.innerHTML = "";
        if (!list.length)
          return (out.innerHTML =
            '<div class="text-gray-500">Nenhum voucher dispon√≠vel.</div>');
        list.slice(0, 8).forEach((v) => {
          const el = document.createElement("div");
          el.className = `p-2 border rounded ${v.used ? "opacity-50" : ""}`;
          el.innerHTML = `<div class="flex justify-between"><div><div class="font-medium">${
            v.code
          }</div><div class="text-xs text-gray-500">${
            v.hotel
          }</div></div><div class="text-sm">${
            v.used ? "Usado" : "Ativo"
          }</div></div>`;
          out.appendChild(el);
        });
      }

      // guest rendering uses internal cache updated by fetchVouchers
      let _cachedVouchers = [];
      function renderGuestListFrom(list) {
        _cachedVouchers = list;
        if (document.getElementById("guest").classList.contains("active-page"))
          renderGuestList();
      }

      function renderGuestList() {
        const filter = document
          .getElementById("guest-email-filter")
          .value.trim()
          .toLowerCase();
        const out = document.getElementById("guest-voucher-list");
        out.innerHTML = "";
        const list = _cachedVouchers.filter((v) => {
          if (!filter) return true;
          return v.guest_email && v.guest_email.toLowerCase() === filter;
        });
        if (!list.length)
          return (out.innerHTML =
            '<div class="text-gray-500">Nenhum voucher encontrado.</div>');
        list.forEach((v) => {
          const el = document.createElement("div");
          el.className = "p-3 border rounded flex flex-col";
          el.innerHTML = `
          <div class="flex justify-between items-start mb-2">
            <div><div class="font-bold">${
              v.code
            }</div><div class="text-xs text-gray-500">${v.hotel} ‚Ä¢ ${
            v.provider
          }</div></div>
            <div><div class="text-sm">${
              v.used ? "Usado" : "Dispon√≠vel"
            }</div></div>
          </div>
          <div class="mt-auto flex gap-2">
            <button class="bg-elotur-blue text-white px-3 py-1 rounded" onclick='(${downloadVoucherPDFFromObj})(${encodeURIComponent(
            JSON.stringify(v)
          )})'>Abrir / Baixar</button>
            <button class="bg-red-500 text-white px-3 py-1 rounded" onclick='validateVoucher("${
              v.code
            }")'>Marcar uso (sim)</button>
          </div>
        `;
          out.appendChild(el);
        });
      }

      /* helper para download: recebe objeto (string-encoded via encodeURIComponent) */
      function downloadVoucherPDFFromObj(str) {
        try {
          const v = JSON.parse(decodeURIComponent(str));
          downloadVoucherPDFObj(v);
        } catch (e) {
          alert("Erro ao gerar PDF");
        }
      }

      /* ---------- criar voucher (chama POST /api/vouchers) ---------- */
      async function handleVoucherCreate(ev) {
        ev.preventDefault();
        const hotel =
          document.getElementById("hotel-name").value || "Hotel Demo";
        const provider =
          document.getElementById("provider-name").value || "Provider Demo";
        const guest_email =
          document.getElementById("guest-email").value || null;
        const payload = { hotel, provider, guest_email };
        const btnMsg = document.getElementById("voucher-create-msg");
        btnMsg.textContent = "Gerando...";
        try {
          const res = await fetch("/api/vouchers", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
          const json = await res.json();
          if (!res.ok) throw new Error(json.error || "Erro");
          btnMsg.textContent = `Gerado: ${json.voucher.code}`;
          fetchVouchers();
          setTimeout(() => (btnMsg.textContent = ""), 3000);
        } catch (err) {
          btnMsg.textContent = "Erro ao gerar";
          console.error(err);
          setTimeout(() => (btnMsg.textContent = ""), 3000);
        }
      }

      /* ---------- validar voucher (POST /api/vouchers/validate) ---------- */
      async function handleValidateClick() {
        const code = document.getElementById("validate-input").value.trim();
        await validateVoucher(code);
      }

      async function validateVoucher(code) {
        if (!code) return alert("Digite o c√≥digo");
        try {
          const res = await fetch("/api/vouchers/validate", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ code }),
          });
          const json = await res.json();
          if (!res.ok) throw new Error(json.error || "Erro");
          document.getElementById(
            "validate-msg"
          ).textContent = `OK: ${json.voucher.code} marcado como usado`;
          fetchVouchers();
          setTimeout(
            () => (document.getElementById("validate-msg").textContent = ""),
            3000
          );
        } catch (err) {
          document.getElementById(
            "validate-msg"
          ).textContent = `Erro: ${err.message}`;
          setTimeout(
            () => (document.getElementById("validate-msg").textContent = ""),
            3000
          );
        }
      }

      /* ---------- c√¢mera (simula√ß√£o) ---------- */
      let _stream = null;
      async function startCamera() {
        try {
          _stream = await navigator.mediaDevices.getUserMedia({ video: true });
          const v = document.getElementById("scanVideo");
          document.getElementById("scan-wrapper").classList.remove("hidden");
          v.srcObject = _stream;
          v.play();
        } catch (err) {
          alert("Erro ao acessar c√¢mera: " + err.message);
        }
      }
      function stopCamera() {
        if (_stream) {
          _stream.getTracks().forEach((t) => t.stop());
          _stream = null;
        }
        document.getElementById("scan-wrapper").classList.add("hidden");
      }
      function simulateScan() {
        // pega primeiro voucher como demo
        if (!_cachedVouchers || !_cachedVouchers.length)
          return alert("Sem vouchers para simular");
        const code = _cachedVouchers[0].code;
        stopCamera();
        alert("Simula√ß√£o: QR detectado -> " + code);
        document.getElementById("validate-input").value = code;
        validateVoucher(code);
      }

      /* ---------- gerar PDF (jsPDF) ---------- */
      function downloadVoucherPDF(encodedStr) {
        try {
          const v = JSON.parse(decodeURIComponent(encodedStr));
          downloadVoucherPDFObj(v);
        } catch (e) {
          // fallback: assume passed object directly
          try {
            const v = JSON.parse(encodedStr);
            downloadVoucherPDFObj(v);
          } catch (err) {
            alert("Erro ao processar voucher para PDF");
          }
        }
      }
      function downloadVoucherPDFObj(v) {
        // se jsPDF carregou
        if (window.jspdf && window.jspdf.jsPDF) {
          const doc = new window.jspdf.jsPDF();
          doc.setFontSize(18);
          doc.text("Voucher EloTur", 14, 20);
          doc.setFontSize(12);
          doc.text(`C√≥digo: ${v.code}`, 14, 36);
          doc.text(`Hotel: ${v.hotel}`, 14, 46);
          doc.text(`Provider: ${v.provider}`, 14, 56);
          if (v.guest_email) doc.text(`H√≥spede: ${v.guest_email}`, 14, 66);
          doc.save(`${v.code}.pdf`);
          return;
        }
        // fallback txt
        const blob = new Blob(
          [
            `Voucher: ${v.code}\nHotel: ${v.hotel}\nProvider: ${
              v.provider
            }\nH√≥spede: ${v.guest_email || "-"}`,
          ],
          { type: "text/plain" }
        );
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `${v.code}.txt`;
        a.click();
        URL.revokeObjectURL(url);
      }

      /* ---------- Feedback (usando o mock handler do mockup) ---------- */
      function handleFeedbackSubmit(e) {
        e.preventDefault();
        const messageBox = document.getElementById("feedback-message");
        messageBox.classList.remove("hidden");
        messageBox.classList.add("text-elotur-blue");
        const usage =
          document.querySelector('input[name="usage"]:checked')?.value || "";
        messageBox.innerHTML = `Obrigado! Uso: "${usage}"`;
        setTimeout(() => {
          document.getElementById("feedback-form").reset();
          messageBox.classList.add("hidden");
          showPage("home");
        }, 2500);
      }

      // Inicia app
      document.addEventListener("DOMContentLoaded", () => {
        showPage("home"); // default
        renderProviderListings(); // render providers
        // se quiser j√° carregar vouchers:
        fetchVouchers();
      });
    </script>
  </body>
</html>
